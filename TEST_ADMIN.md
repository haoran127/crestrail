# Web 管理后台测试清单

## 🧪 测试准备

### 1. 确保服务器运行

```bash
# 在项目根目录
cargo run
```

你应该看到：
```
🚀 服务器启动在 http://127.0.0.1:3000
📡 API 端点: http://127.0.0.1:3000/api/:schema/:table
```

### 2. 确保数据库已迁移

```bash
psql -U your_username -d your_database -f migrations/001_create_users_table.sql
```

---

## ✅ 测试步骤

### 测试 1: 访问管理后台 ✓

**步骤**:
1. 打开浏览器
2. 访问 `http://localhost:3000/admin/`
3. 检查页面是否正常加载

**预期结果**:
- ✅ 看到登录页面
- ✅ 有蓝紫渐变背景
- ✅ 显示 "CrestRail 数据库管理后台"
- ✅ 有邮箱和密码输入框

**故障排除**:
- 如果 404: 检查 `admin/` 目录是否存在
- 如果页面空白: 打开浏览器控制台查看错误
- 如果样式异常: 检查 CDN 是否可访问

---

### 测试 2: 登录功能 ✓

**步骤**:
1. 输入邮箱: `admin@example.com`
2. 输入密码: `Admin123`
3. 点击"登录"

**预期结果**:
- ✅ 显示"登录成功"通知（绿色）
- ✅ 自动跳转到主界面
- ✅ 左侧显示导航菜单
- ✅ 顶部显示用户邮箱

**故障排除**:
- 如果提示"邮箱或密码错误": 检查数据库中是否有该用户
- 如果网络错误: 检查 API 服务器是否运行
- 如果 CORS 错误: 检查服务器 CORS 配置

**验证 API**:
```bash
# 手动测试登录
curl -X POST http://localhost:3000/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@example.com","password":"Admin123"}'
```

---

### 测试 3: 数据表管理 ✓

**步骤**:
1. 点击左侧菜单"数据表"
2. 等待表列表加载
3. 点击"users"表

**预期结果**:
- ✅ 显示数据表卡片
- ✅ 点击后显示表数据
- ✅ 显示列名和数据
- ✅ 有搜索框和分页控制

**测试搜索**:
1. 在搜索框输入"admin"
2. 检查是否过滤数据

**测试编辑**:
1. 点击某条记录的编辑图标
2. 修改数据
3. 点击保存

**测试新增**:
1. 点击"新增"按钮
2. 填写表单
3. 点击"新增"

**测试删除**:
1. 点击删除图标
2. 确认删除

---

### 测试 4: 健康检查 ✓

**步骤**:
1. 点击顶部"健康检查"按钮

**预期结果**:
- ✅ 显示绿色通知
- ✅ 显示系统健康状态
- ✅ 显示数据库状态
- ✅ 显示连接池信息

**验证 API**:
```bash
curl http://localhost:3000/health | jq '.'
```

预期输出：
```json
{
  "status": "healthy",
  "database": {
    "status": "healthy",
    "connected": true
  },
  "pool": {
    "size": 20,
    "idle": 15,
    "active": 5
  },
  "version": "0.2.0"
}
```

---

### 测试 5: 事务管理 ✓

**步骤**:
1. 点击左侧菜单"事务管理"
2. 点击"添加操作"
3. 配置操作：
   - 方法: POST
   - Schema: public
   - Table: users
   - 数据: 
   ```json
   {"username":"txtest","email":"txtest@test.com","password_hash":"$2b$12$test","role":"user"}
   ```
4. 点击"执行事务"

**预期结果**:
- ✅ 显示执行结果
- ✅ 显示成功操作数
- ✅ 显示耗时
- ✅ 显示返回数据

**验证数据**:
```bash
curl http://localhost:3000/api/public/users?email=eq.txtest@test.com
```

**清理测试数据**:
```bash
curl -X DELETE "http://localhost:3000/api/public/users?email=txtest@test.com"
```

---

### 测试 6: 用户管理 ✓

**步骤**:
1. 点击左侧菜单"用户管理"
2. 查看用户列表

**预期结果**:
- ✅ 显示所有用户
- ✅ 显示用户名、邮箱、角色
- ✅ 角色有不同颜色标签
- ✅ 显示创建时间

---

### 测试 7: 响应式设计 ✓

**步骤**:
1. 调整浏览器窗口大小
2. 测试不同分辨率

**预期结果**:
- ✅ 桌面: 正常显示
- ✅ 平板: 布局适应
- ✅ 手机: 可用（部分功能）

---

### 测试 8: 错误处理 ✓

**测试无效登录**:
1. 输入错误密码
2. 点击登录

**预期**:
- ✅ 显示错误提示（红色）
- ✅ 不跳转

**测试 Token 过期**:
1. 清除 localStorage 中的 token
2. 刷新页面

**预期**:
- ✅ 自动返回登录页

---

## 🐛 常见问题

### 问题 1: 静态文件无法访问

**症状**: 访问 `/admin/` 返回 404

**解决**:
```bash
# 检查 admin 目录是否存在
ls -la admin/

# 应该看到:
# index.html
# components.js
# app.js

# 检查 Cargo.toml 是否添加了 fs feature
grep "tower-http" Cargo.toml

# 应该看到:
# tower-http = { version = "0.5", features = ["cors", "trace", "fs"] }
```

### 问题 2: API 请求失败

**症状**: 浏览器控制台显示 CORS 或网络错误

**解决**:
1. 检查 API URL 配置（`admin/app.js`）
2. 确认服务器运行在 `http://localhost:3000`
3. 检查浏览器控制台网络选项卡

### 问题 3: 登录后白屏

**症状**: 登录成功但页面空白

**解决**:
1. 打开浏览器控制台查看 JavaScript 错误
2. 检查 Vue.js 是否正确加载
3. 清除浏览器缓存

---

## 📊 测试结果记录

### 测试环境

- **操作系统**: _________
- **浏览器**: _________
- **服务器版本**: _________
- **数据库**: _________

### 测试结果

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 1. 访问管理后台 | ⬜ | |
| 2. 登录功能 | ⬜ | |
| 3. 数据表管理 | ⬜ | |
| 4. 健康检查 | ⬜ | |
| 5. 事务管理 | ⬜ | |
| 6. 用户管理 | ⬜ | |
| 7. 响应式设计 | ⬜ | |
| 8. 错误处理 | ⬜ | |

### 发现的问题

1. _________________
2. _________________
3. _________________

---

## ✅ 测试通过标准

全部测试项通过后，表示管理后台功能正常，可以继续开发剩余功能：

- [ ] 细粒度权限控制（RBAC + RLS）
- [ ] 多表 JOIN 查询
- [ ] Redis 缓存层

---

**测试完成后，请报告结果！** 🎯

